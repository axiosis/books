\addtocontents{toc}{\protect\newpage}
\chapter{Юридично-документальний рівень}

\section{Вступ}

Друге видання КНИГИ ERP (англ. ERP BOOK VOL.3 Blue Book) визначає формальну
бізнес специфікацію та її імплементацію для сучасних оптимізованих підприємств.
Системи ERP на її базі також уже не один рік використовується у банківській сфері,
процесінгу транзакцій, розподілених системах повідомлень, в IoT секторі.

\section{Модулі підприємства}

ERP.UNO є комплексом бібліотек (N2O.DEV) та підсистем додатків (ERP.UNO),
який використовує загальну шину і загальну розподілену базу даних для швидкіснх операційних вітрин.
\\
\\
\textbf{ERP} — Даний модуль обліково-реєстраційного рівня зберігає основну ієрархічну структуру
        підприємства, її схему, метаінформацію про типи даних, а також сам інформіцію:
        записи про персонал, інвентар, компанії та офіси підприємства.
\\
\\
\textbf{CRM} — Система управління зв'язками з громадськістю та органами виконавчої влади:
        являє собою базову реалізацію постанови \#55 КМУ.
\\
\\
\textbf{CART} — Система управління клієнтами: являє собою розширення більш
           абстрактного додатку CHAT.

\section{Управління ресурсами}

Головним чином інформаційна структура нашого підприємства
складається з обчислювальних ресурсов (додатки, запущені в шині)
та накопичувальних ресурсів (дані, збережені в базі даних).
\
\\
SOA архітектура в якості моделі управління обчислювальними
ресурсами пропонує асинхронний протокол віддаленого виклику на шинах.
Разом з N2O можно використовувати MQTT та інші шини, за допомогою наступних протоколів: TCP, WebSocket.
Ці асинхронні протоколи часто називають
протоколами реального часу, оскільки в них функції відправки повідомлень завжди
миттєво повертають результат. Що ж стосується протоколів для публікації і доступу
до даних, то тут може виявитися доречним використання синхронного HTTP протоколу.

\newpage
\section{Обчислювальні ресурси}

Для SOA архітектури традиційно використовуються асинхронні
протоколи доступу до обчислювальних ресурсів. Зазвичай це серверні
воркери, які підключені до шини і обслуговують API певного додатку.
Кожен додаток має власне консистентне хеш-кільце воркерів. В мережі
одночасно працює багато кілець-додатків.

\begin{lstlisting}
config :n2o,
  tcp_services: ['ldap'],
  ws_services: ['chat'],
  mqtt_services: ['erp', 'bpe']
   \end{lstlisting}

за допомогою {\bf config.exs} файлу можна налаштувати необхідну
конфігурацію серії консистентних кілець, кожне з яких працює
на власному транспортному протоколі. В даному прикладі показано
карту Erlang серверів, які обслуговують черги додатків в шині:

\begin{lstlisting}
> PLM.vnodes
[
  {{:tcp, '/ldap/tcp/4'}, [:n2o_tcp]},
  {{:tcp, '/ldap/tcp/3'}, [:n2o_tcp]},
  {{:tcp, '/ldap/tcp/2'}, [:n2o_tcp]},
  {{:tcp, '/ldap/tcp/1'}, [:n2o_tcp]},
  {{:ws, '/chat/ws/4'}, [:n2o_ws]},
  {{:ws, '/chat/ws/3'}, [:n2o_ws]},
  {{:ws, '/chat/ws/2'}, [:n2o_ws]},
  {{:ws, '/chat/ws/1'}, [:n2o_ws]},
  {{:mqtt, '/erp/mqtt/4'}, [:n2o_mqtt]},
  {{:mqtt, '/erp/mqtt/3'}, [:n2o_mqtt]},
  {{:mqtt, '/erp/mqtt/2'}, [:n2o_mqtt]},
  {{:mqtt, '/erp/mqtt/1'}, [:n2o_mqtt]},
  {{:mqtt, '/bpe/mqtt/4'}, [:n2o_mqtt]},
  {{:mqtt, '/bpe/mqtt/3'}, [:n2o_mqtt]},
  {{:mqtt, '/bpe/mqtt/2'}, [:n2o_mqtt]},
  {{:mqtt, '/bpe/mqtt/1'}, [:n2o_mqtt]},
  {{:caching, 'timer'}, [:n2o]}
]
\end{lstlisting}

Завдяки такій деталізації можна проектувати гетерогенні системи,
включаючи необхідний набір протоколів на портах потрібних машин. Ця же система
дозволяє отримати балансування навантаження, підключаючи фізичні ресурси
до певних черг шини даних.

В нашій моделі асинхронні протоколи використовуються для управління
обчислювальними ресурсами підприємства.

\newpage
\section{Накопичувальні ресурси}

Розподілені хеш-кільця використовуються не тільки для розподілених обчислень,
але і для зберігання даних.
Деякі бази даних, наприклад RocksDB та Cassandra, використовують глобальний простір
ключів для даних (на відміну від таблично-орієнтованих баз). Саме для таких
баз і створено библиотеку KVS, де в якості синхронного транзакційного
інтерфейсу — API ланцюжків з гарантією консистентності. Нижче
наведено приклад структури ланцюжків екземпляру системи PLM:

   \begin{lstlisting}
> :kvs.all :writer
[
  {:writer, '/bpe/proc', 2},
  {:writer, '/erp/group', 1},
  {:writer, '/erp/partners', 7},
  {:writer, '/acc/synrc/Kyiv', 3},
  {:writer, '/chat/5HT', 1},
  {:writer, '/bpe/hist/1562187187807717000', 8},
  {:writer, '/bpe/hist/1562192587632329000', 1}
]
\end{lstlisting}

В нашій моделі синхронні протоколи використовуються для управління
накопичувальними ресурсами підприємства і транзакційного процесингу.

\section{Типові специфікації}

Протоколи визначаються типовими специфікаціями і генеруються для наступних мов:
Java, Swift, JavaScript, Google Protobuf V3, ASN.1. Також ми генеруємо валідатори даних по цих
типових анотаціях і вбудовуємо ці валідатори в тракт наших розподілених протоколів,
тому ми ніколи не дозволимо клієнтам зіпсувати сторадж. Для веб додатків у нас развинута
система валідації — як для JavaScript, так і на стороні сервера. Бізнес логіка повністью ізольована в нашій
системі управління бізнес процесами, де кожен бізнес процесс
є процесом віртуальної машини. Всі ланцюжки модифікуються атомарним чином,
підтримують flake адресацію, і не вимагають додаткової ізоляції
у своєму примітивному використанні.
Тому ви можете трактувати базу як розподілений кеш
і використовувати її з фронт додатків для примітивних випадків.

\section{Архітектура CRM системи}

\subsection{Сторінки}

\subsection{Елементи}

\subsection{Комболукап}

\subsection{Сервіси}

\subsection{СЕВ ОВВ}

\subsection{Шаблони}

\subsection{Дерева}

\subsection{Процеси}

\subsection{Документи}

\subsection{Редактори}




